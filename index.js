const ids = ['ground', 'head', 'scaffold', 'legs', 'arms', 'body'];
let result;
let letters = [];
let chances = 0;
let guesses = [];

LoadHangmanSVG("hangman.svg");
StartLetterBoxes();

function StartLetterBoxes() {
    document.addEventListener('DOMContentLoaded', () => {
        const word = GetRandomWord();
        document.getElementById("letterbox-container").innerHTML = GenerateLetterBoxes(letters, word);
        AskPlayer(word);
    });
}

function GenerateLetterBoxes(letter, word) {
    let letterBoxes = Array(word.length).fill('');
    for (let i = 0; i < word.length; i++) {

        if (letter[i] === word[i]) {
            letterBoxes.push(`<div class="letter-box">${letter[i]}</div>`);
        } else {
            letterBoxes.push(`<div class="letter-box"></div>`);
        }


    }
    return letterBoxes.join('');
}

function LoadHangmanSVG(path) {
    const obj = document.createElement('object');
    const hangmanElement = document.querySelector("#hangman-game");
    obj.id = "hangman";
    obj.type = "image/svg+xml";
    obj.data = path;


    hangmanElement.append(obj);
    obj.addEventListener('load', () => {
        const svgDoc = obj.contentWindow.document;
        const svgElements = svgDoc.querySelector('svg');
        for (let child of svgElements.childNodes) {
            if (child.nodeType === Node.ELEMENT_NODE) {
                child.style.opacity = "0";
            }
        }

    });

}

function ChangeOpacity(id) {
    const svgDocument = document.querySelector("#hangman").contentWindow.document;
    const SVGSVGElement = svgDocument.querySelector("svg");
    let element = SVGSVGElement.getElementById(id);
    if (element) {
        element.style.opacity = "1";
    }
}

function GetRandomWord() {
    const fooWords = ["MONITOR", "PROGRAM", "APPLICATION", "KEYBOARD", "JAVASCRIPT", "AUTOGENERATED", "NETWORK"];
    const randomIndex = Math.floor(Math.random() * fooWords.length);
    return fooWords[randomIndex];

}

function AskPlayer(word) {
    const userInputForm = document.querySelector('.input-field-form');
    const userInputField = document.querySelector("input[name='user-input']");
    userInputField.addEventListener('input', function () {
        result = this.value;
    });
    userInputForm.addEventListener('submit', function (e) {
        e.preventDefault();
        result = result ? result.toUpperCase().trim() : '';
        let duplicate = CheckAnswer(result)
        if (!duplicate) {
            RevealWord(result, word);
        }
    });
}

function RevealWord(guess, word) {
    let incorrectGuess = true;
    if (guess === word) {
        let wholeWord = [...guess];
        document.getElementById("letterbox-container").innerHTML = GenerateLetterBoxes(wholeWord, word);
        incorrectGuess = false;
    }
    for (let i = 0; i < word.length; i++) {
        if (guess === word[i]) {
            letters[i] = guess
            document.getElementById("letterbox-container").innerHTML = GenerateLetterBoxes(letters, word);
            incorrectGuess = false;
        }
    }
    guesses.push(guess);
    if (incorrectGuess) {
        ProceedHangman(ids[chances])
        chances += 1;
    }
    PresentGuesses(guess);
    GameOver(letters, word, guess);
}

function ProceedHangman(id) {
    ChangeOpacity(id)
}

function CheckAnswer(answer) {
    return guesses.some((guess) => guess === answer);
}

function GameOver(letters, word, guess) {
    const submitButton = document.querySelector("button[type='submit']");
    let currentWord = "";
    letters.forEach((letter) => {
        currentWord += letter;

    });
    if (chances === 6) {
        submitButton.disabled = true;

    } else if (currentWord === word || word === guess) {
        submitButton.disabled = true;
        const containerGameBoard = document.querySelector('.container-game-board');
        const body = document.querySelector('body');
        containerGameBoard.addEventListener("mouseover", function () {
            containerGameBoard.style.backgroundColor = CursorDisco();
        });
        body.style.backgroundColor = "black";
    }


}

function CursorDisco() {
    const hue = Math.floor(Math.random() * 361);
    const saturation = Math.random() * 100;
    const lightness = Math.floor(Math.random() * 91) + 5;
    return `hsl(${hue}, ${saturation}%, ${lightness}%)`;

}

function PresentGuesses(guess) {
    const guessDiv = document.querySelector('#guessWork');
        guessDiv.innerHTML += `<p>${guess}</p>`

}
